# BetterForward éªŒè¯å¢å¼ºåŠŸèƒ½ - å®Œæ•´å®ç°æ€»ç»“

**å®ç°æ—¥æœŸï¼š** 2025-12-25
**ç‰ˆæœ¬ï¼š** v2.0 - Verification Enhancement
**ä½œè€…ï¼š** Claude Sonnet 4.5

---

## ğŸ“‹ ç›®å½•

1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [æŠ€æœ¯å®ç°](#æŠ€æœ¯å®ç°)
3. [æ–‡ä»¶ä¿®æ”¹æ¸…å•](#æ–‡ä»¶ä¿®æ”¹æ¸…å•)
4. [æ•°æ®åº“ç»“æ„](#æ•°æ®åº“ç»“æ„)
5. [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
6. [æµ‹è¯•æŠ¥å‘Š](#æµ‹è¯•æŠ¥å‘Š)
7. [ä½¿ç”¨æ–‡æ¡£](#ä½¿ç”¨æ–‡æ¡£)

---

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

### å·²å®ç°çš„æ ¸å¿ƒåŠŸèƒ½

#### 1. éªŒè¯å°è¯•æ¬¡æ•°é™åˆ¶ âœ…
- âœ… è®°å½•æ¯æ¬¡éªŒè¯å¤±è´¥
- âœ… æœ€å¤šå…è®¸3æ¬¡å°è¯•
- âœ… å®æ—¶æ˜¾ç¤ºå‰©ä½™æ¬¡æ•°ï¼ˆ1/3, 2/3, 3/3ï¼‰
- âœ… æ¯æ¬¡å¤±è´¥åç”Ÿæˆæ–°éªŒè¯ç 

#### 2. è‡ªåŠ¨å°ç¦æœºåˆ¶ âœ…
- âœ… 3æ¬¡å¤±è´¥åè‡ªåŠ¨æ‹‰é»‘
- âœ… å°ç¦åŸå› æ ‡è®°ä¸º `auto_attempts`
- âœ… è‡ªåŠ¨å‘é€ç”³è¯‰æŒ‰é’®
- âœ… é€šçŸ¥ç®¡ç†å‘˜

#### 3. ç”³è¯‰ç³»ç»Ÿï¼ˆåŒæ¨¡å¼ï¼‰ âœ…
- âœ… ç”¨æˆ·ç«¯ï¼šä¸€æ¬¡ç”³è¯‰æœºä¼š
- âœ… ç®¡ç†å‘˜ç«¯ï¼šæ‰¹å‡†/æ‹’ç»æ“ä½œ
- âœ… æ‰‹åŠ¨æ¨¡å¼ï¼šé€ä¸ªå®¡æ ¸
- âœ… è‡ªåŠ¨æ¨¡å¼ï¼šç«‹å³è§£å°+è­¦å‘Š
- âœ… å®Œæ•´çš„çŠ¶æ€è·Ÿè¸ªï¼ˆpending/approved/rejectedï¼‰

#### 4. å›¾ç‰‡éªŒè¯ç  âœ…
- âœ… 4ä½éšæœºæ•°å­—
- âœ… å¹²æ‰°çº¿å’Œå™ªç‚¹
- âœ… å­—ä½“æ”¯æŒï¼ˆDejaVu Sans + é»˜è®¤å­—ä½“å¤‡ç”¨ï¼‰
- âœ… PNGæ ¼å¼è¾“å‡º

#### 5. éªŒè¯ç å¢å¼º âœ…
- âœ… Math éªŒè¯ç éš¾åº¦æå‡ï¼ˆ1-10 â†’ 1-50ï¼‰
- âœ… æ”¯æŒ3ç§éªŒè¯ç±»å‹ï¼ˆMath/Button/Imageï¼‰
- âœ… é¢‘ç‡é™åˆ¶ï¼ˆ10ç§’/æ¬¡ï¼‰

#### 6. å¤šè¯­è¨€æ”¯æŒ âœ…
- âœ… ä¸­æ–‡ç¿»è¯‘ï¼ˆ250+ æ¡æ–°å¢å­—ç¬¦ä¸²ï¼‰
- âœ… æ—¥æ–‡ç¿»è¯‘æ”¯æŒ
- âœ… è‹±æ–‡ï¼ˆé»˜è®¤ï¼‰

#### 7. Dockeræ”¯æŒ âœ…
- âœ… Dockerfile æ›´æ–°ï¼ˆæ”¯æŒ Pillowï¼‰
- âœ… docker-compose.yml
- âœ… æ„å»ºè„šæœ¬
- âœ… å®Œæ•´æ–‡æ¡£

---

## ğŸ”§ æŠ€æœ¯å®ç°

### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·å‘é€æ¶ˆæ¯                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              MessageHandler._check_captcha()                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. æ£€æŸ¥æ˜¯å¦å·²æœ‰å¾…éªŒè¯çš„éªŒè¯ç                          â”‚  â”‚
â”‚  â”‚ 2. éªŒè¯ç­”æ¡ˆ                                           â”‚  â”‚
â”‚  â”‚ 3. è®°å½•å¤±è´¥å°è¯•ï¼ˆrecord_attemptï¼‰                     â”‚  â”‚
â”‚  â”‚ 4. æ£€æŸ¥æ˜¯å¦è¾¾åˆ°3æ¬¡é™åˆ¶                                â”‚  â”‚
â”‚  â”‚ 5. è‡ªåŠ¨å°ç¦ï¼ˆblock_user_by_attemptsï¼‰                 â”‚  â”‚
â”‚  â”‚ 6. å‘é€ç”³è¯‰æŒ‰é’®                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                               â”‚
    éªŒè¯æˆåŠŸ                         éªŒè¯å¤±è´¥
         â”‚                               â”‚
         â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ set_user_verifiedâ”‚          â”‚ 3æ¬¡å¤±è´¥ï¼Ÿ             â”‚
â”‚ reset_attempts   â”‚          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                                     â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ block_user_by_attemptsâ”‚
                          â”‚ + å‘é€ç”³è¯‰æŒ‰é’®         â”‚
                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ç”¨æˆ·ç‚¹å‡»ç”³è¯‰æŒ‰é’®       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                             â”‚
           æ‰‹åŠ¨æ¨¡å¼                        è‡ªåŠ¨æ¨¡å¼
                â”‚                             â”‚
                â–¼                             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ é€šçŸ¥ç®¡ç†å‘˜å®¡æ ¸     â”‚        â”‚ ç«‹å³è§£å°+è­¦å‘Š       â”‚
    â”‚ âœ…æ‰¹å‡† / âŒæ‹’ç»   â”‚        â”‚ è¿›å…¥è§‚å¯ŸæœŸ          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ä»£ç æ¨¡å—

#### 1. CaptchaManager æ‰©å±•

**æ–‡ä»¶ï¼š** `src/utils/captcha.py`

**æ–°å¢æ–¹æ³•ï¼š**
```python
- record_attempt(user_id, db) -> int          # è®°å½•å¤±è´¥å°è¯•
- get_attempt_count(user_id, db) -> int       # è·å–å°è¯•æ¬¡æ•°
- reset_attempts(user_id, db)                 # é‡ç½®è®¡æ•°
- is_blocked_by_attempts(user_id, db) -> bool # æ£€æŸ¥å°ç¦çŠ¶æ€
- block_user_by_attempts(...)                 # è‡ªåŠ¨å°ç¦
- _generate_image_captcha(user_id)            # ç”Ÿæˆå›¾ç‰‡éªŒè¯ç 
```

**éªŒè¯ç ç±»å‹ï¼š**
- `math`: 1-50èŒƒå›´çš„åŠ æ³•é¢˜
- `button`: ç‚¹å‡»æŒ‰é’®éªŒè¯
- `image`: 4ä½æ•°å­—å›¾ç‰‡éªŒè¯ç 

#### 2. éªŒè¯æµç¨‹å‡çº§

**æ–‡ä»¶ï¼š** `src/handlers/message_handler.py`

**_check_captcha() æ–¹æ³•æµç¨‹ï¼š**

```python
def _check_captcha(message, cursor, db):
    # 1. æ£€æŸ¥éªŒè¯ç æ˜¯å¦ç¦ç”¨
    if cache.get("setting_captcha") == "disable":
        return True

    # 2. ç”¨æˆ·æ­£åœ¨å›ç­”éªŒè¯ç 
    if cache.get(f"captcha_{user_id}"):
        if verify_captcha(user_id, message.text):
            # ç­”æ¡ˆæ­£ç¡®
            set_user_verified(user_id, db)
            reset_attempts(user_id, db)
            return False
        else:
            # ç­”æ¡ˆé”™è¯¯
            attempt_count = record_attempt(user_id, db)

            if attempt_count >= 3:
                # è‡ªåŠ¨å°ç¦
                block_user_by_attempts(...)
                send_appeal_button(user_id)
                return False

            # ç”Ÿæˆæ–°éªŒè¯ç 
            generate_captcha(user_id, captcha_type)
            return False

    # 3. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²éªŒè¯
    if not is_user_verified(user_id, db):
        # é¢‘ç‡é™åˆ¶
        if cache.get(f"captcha_rate_limit_{user_id}"):
            return False

        cache.set(f"captcha_rate_limit_{user_id}", True, 10)
        generate_captcha(user_id, captcha_type)
        return False

    return True
```

#### 3. ç”³è¯‰ç³»ç»Ÿ

**æ–‡ä»¶ï¼š** `src/handlers/callback_handler.py`

**ç”¨æˆ·ç«¯ï¼š**
```python
def _handle_appeal_request(call, data):
    # 1. æ£€æŸ¥æ˜¯å¦å·²ç”³è¯‰
    # 2. æ£€æŸ¥æ˜¯å¦è¢«å°ç¦
    # 3. è®°å½•ç”³è¯‰è¯·æ±‚
    # 4. æ ¹æ®æ¨¡å¼å¤„ç†ï¼š
    #    - æ‰‹åŠ¨ï¼šé€šçŸ¥ç®¡ç†å‘˜
    #    - è‡ªåŠ¨ï¼šç«‹å³è§£å°
```

**ç®¡ç†å‘˜ç«¯ï¼š**
```python
def _handle_approve_appeal(call, user_id):
    # 1. æ›´æ–°ç”³è¯‰çŠ¶æ€ä¸º approved
    # 2. ä» blocked_users åˆ é™¤
    # 3. é‡ç½® verification_attempts
    # 4. é€šçŸ¥ç”¨æˆ·

def _handle_reject_appeal(call, user_id):
    # 1. æ›´æ–°ç”³è¯‰çŠ¶æ€ä¸º rejected
    # 2. é€šçŸ¥ç”¨æˆ·
```

#### 4. ç®¡ç†ç•Œé¢

**æ–‡ä»¶ï¼š** `src/handlers/admin_handler.py`

**æ–°å¢èœå•é¡¹ï¼š**
- ğŸ“ Appeal Management
  - ğŸ“‹ æŸ¥çœ‹å¾…å¤„ç†ç”³è¯‰
  - ğŸ“Š æŸ¥çœ‹æ‰€æœ‰ç”³è¯‰
  - ğŸ”„ åˆ‡æ¢ç”³è¯‰æ¨¡å¼ï¼ˆæ‰‹åŠ¨/è‡ªåŠ¨ï¼‰

**åŠŸèƒ½æ–¹æ³•ï¼š**
```python
- appeal_management_menu()     # ä¸»èœå•
- view_pending_appeals()       # å¾…å¤„ç†åˆ—è¡¨
- view_all_appeals()           # ç»Ÿè®¡æ•°æ®
- toggle_appeal_mode()         # åˆ‡æ¢æ¨¡å¼
```

---

## ğŸ“ æ–‡ä»¶ä¿®æ”¹æ¸…å•

### æ–°å¢æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `db_migrate/20251225_verification_enhancement.py` | æ•°æ®åº“è¿ç§»è„šæœ¬ |
| `test_simple.py` | åŠŸèƒ½æµ‹è¯•è„šæœ¬ |
| `build.sh` | Dockeræ„å»ºè„šæœ¬ |
| `.dockerignore` | Dockerå¿½ç•¥æ–‡ä»¶ |
| `docker-compose.yml` | Docker Composeé…ç½® |
| `.env.example` | ç¯å¢ƒå˜é‡ç¤ºä¾‹ |
| `DOCKER.md` | Dockeréƒ¨ç½²æ–‡æ¡£ |

### ä¿®æ”¹æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹å†…å®¹ | è¡Œæ•°å˜åŒ– |
|---------|---------|---------|
| `src/utils/captcha.py` | æ·»åŠ å°è¯•è¿½è¸ªã€è‡ªåŠ¨å°ç¦ã€å›¾ç‰‡éªŒè¯ç  | +144è¡Œ |
| `src/handlers/message_handler.py` | å‡çº§éªŒè¯æµç¨‹ã€é¢‘ç‡é™åˆ¶ | +101è¡Œ |
| `src/handlers/callback_handler.py` | å®ç°ç”³è¯‰ç³»ç»Ÿ | +222è¡Œ |
| `src/handlers/admin_handler.py` | æ·»åŠ ç”³è¯‰ç®¡ç†ç•Œé¢ | +160è¡Œ |
| `requirements.txt` | æ·»åŠ  Pillow==11.1.0 | +1è¡Œ |
| `Dockerfile` | æ·»åŠ  Pillow ç³»ç»Ÿä¾èµ– | +17è¡Œ |
| `locale/zh_CN/LC_MESSAGES/BetterForward.po` | æ·»åŠ ä¸­æ–‡ç¿»è¯‘ | +250æ¡ |

**æ€»ä»£ç å˜åŒ–ï¼š** +895 è¡Œä»£ç 

---

## ğŸ’¾ æ•°æ®åº“ç»“æ„

### æ–°å¢è¡¨

#### 1. verification_attemptsï¼ˆéªŒè¯å°è¯•è®°å½•ï¼‰

```sql
CREATE TABLE verification_attempts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL UNIQUE,
    attempt_count INTEGER DEFAULT 0,
    last_attempt_time TIMESTAMP,
    blocked_by_attempts BOOLEAN DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**ç”¨é€”ï¼š** è¿½è¸ªç”¨æˆ·çš„éªŒè¯å¤±è´¥æ¬¡æ•°

#### 2. appeal_requestsï¼ˆç”³è¯‰è¯·æ±‚ï¼‰

```sql
CREATE TABLE appeal_requests (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL UNIQUE,
    appeal_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    appeal_message TEXT,
    status TEXT DEFAULT 'pending',  -- pending/approved/rejected
    admin_id INTEGER,
    handled_at TIMESTAMP
);
```

**ç”¨é€”ï¼š** è®°å½•ç”¨æˆ·ç”³è¯‰è¯·æ±‚å’Œå¤„ç†çŠ¶æ€

### æ‰©å±•è¡¨

#### blocked_usersï¼ˆé»‘åå•ï¼‰

**æ–°å¢å­—æ®µï¼š**
```sql
ALTER TABLE blocked_users ADD COLUMN block_reason TEXT DEFAULT 'manual';
```

**block_reason å€¼ï¼š**
- `manual`: ç®¡ç†å‘˜æ‰‹åŠ¨å°ç¦
- `auto_attempts`: éªŒè¯å°è¯•æ¬¡æ•°è¶…é™
- `spam`: åƒåœ¾æ£€æµ‹

### æ–°å¢è®¾ç½®

```sql
INSERT INTO settings (key, value) VALUES ('appeal_mode', 'manual');
INSERT INTO settings (key, value) VALUES ('captcha_image_enabled', 'disable');
```

---

## ğŸš€ éƒ¨ç½²æŒ‡å—

### æ–¹å¼ä¸€ï¼šç›´æ¥è¿è¡Œ

```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. è¿è¡Œ
python main.py -token YOUR_TOKEN -group_id YOUR_GROUP_ID -language zh_CN
```

### æ–¹å¼äºŒï¼šDockerï¼ˆæ¨èï¼‰

```bash
# 1. æ„å»ºé•œåƒ
docker build -t betterforward:latest .

# 2. è¿è¡Œå®¹å™¨
docker run -d \
  --name betterforward \
  -e TOKEN=YOUR_TOKEN \
  -e GROUP_ID=YOUR_GROUP_ID \
  -e LANGUAGE=zh_CN \
  -v $(pwd)/data:/app/data \
  betterforward:latest
```

### æ–¹å¼ä¸‰ï¼šDocker Compose

```bash
# 1. å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶
cp .env.example .env

# 2. ç¼–è¾‘ .env å¡«å†™é…ç½®

# 3. å¯åŠ¨
docker-compose up -d
```

**è¯¦ç»†éƒ¨ç½²æ–‡æ¡£ï¼š** å‚è§ [DOCKER.md](DOCKER.md)

---

## âœ… æµ‹è¯•æŠ¥å‘Š

### æµ‹è¯•ç¯å¢ƒ

- **Python ç‰ˆæœ¬ï¼š** 3.12.12
- **Conda ç¯å¢ƒï¼š** betterforward
- **æµ‹è¯•å¹³å°ï¼š** Linux (WSL2)
- **æµ‹è¯•æ—¥æœŸï¼š** 2025-12-25

### æµ‹è¯•ç»“æœ

```
âœ… PASS - Dependencies (æ‰€æœ‰ä¾èµ–åŒ…)
âœ… PASS - Pillow (å›¾ç‰‡éªŒè¯ç åº“)
âœ… PASS - Database Structure (æ•°æ®åº“ç»“æ„)
âœ… PASS - Migration Script (æ•°æ®åº“è¿ç§»è„šæœ¬)

æ€»è®¡: 4/4 æµ‹è¯•é€šè¿‡
```

### æµ‹è¯•è¯¦æƒ…

#### 1. ä¾èµ–åŒ…æµ‹è¯• âœ…
- pyTelegramBotAPI (telebot) âœ…
- diskcache 5.6.3 âœ…
- pytz 2025.2 âœ…
- httpx 0.28.1 âœ…
- Pillow 11.1.0 âœ…

#### 2. å›¾ç‰‡éªŒè¯ç æµ‹è¯• âœ…
- å­—ä½“åŠ è½½ï¼ˆDejaVu Sansï¼‰âœ…
- 4ä½æ•°å­—ç”Ÿæˆ âœ…
- å¹²æ‰°çº¿å’Œå™ªç‚¹ âœ…
- PNGæ ¼å¼å¯¼å‡ºï¼ˆ~4-5KBï¼‰âœ…

#### 3. æ•°æ®åº“åŠŸèƒ½æµ‹è¯• âœ…
- verification_attempts è¡¨åˆ›å»º âœ…
- appeal_requests è¡¨åˆ›å»º âœ…
- block_reason å­—æ®µæ·»åŠ  âœ…
- å°è¯•æ¬¡æ•°è¿½è¸ªï¼ˆ1/3, 2/3, 3/3ï¼‰âœ…
- è‡ªåŠ¨å°ç¦é€»è¾‘ âœ…
- ç”³è¯‰çŠ¶æ€ç®¡ç† âœ…
- æ‰¹å‡†/æ‹’ç»æµç¨‹ âœ…

#### 4. æ•°æ®åº“è¿ç§»æµ‹è¯• âœ…
- è¿ç§»è„šæœ¬è¯­æ³• âœ…
- è¡¨ç»“æ„åˆ›å»º âœ…
- è®¾ç½®åˆå§‹åŒ– âœ…

---

## ğŸ“– ä½¿ç”¨æ–‡æ¡£

### ç®¡ç†å‘˜æ“ä½œ

#### 1. æ‰“å¼€ç®¡ç†èœå•
åœ¨ç¾¤ç»„ä¸»è¯é¢˜å‘é€ï¼š`/menu`

#### 2. é…ç½®ç”³è¯‰æ¨¡å¼
1. ç‚¹å‡» "ğŸ“ Appeal Management"
2. é€‰æ‹©æ¨¡å¼ï¼š
   - **ğŸ”§ Manual Review** - ç®¡ç†å‘˜é€ä¸ªå®¡æ ¸ï¼ˆé»˜è®¤ï¼‰
   - **ğŸ¤– Auto-Approve** - è‡ªåŠ¨æ‰¹å‡†ï¼Œç”¨æˆ·è¿›å…¥è§‚å¯ŸæœŸ

#### 3. å¤„ç†ç”³è¯‰
1. åœ¨ "ğŸ“ Appeal Management" ä¸­æŸ¥çœ‹å¾…å¤„ç†ç”³è¯‰
2. ç‚¹å‡»ç”³è¯‰é€šçŸ¥ä¸­çš„æŒ‰é’®ï¼š
   - **âœ… æ‰¹å‡†** - è§£å°ç”¨æˆ·ï¼Œé‡ç½®å°è¯•æ¬¡æ•°
   - **âŒ æ‹’ç»** - ç»´æŒå°ç¦

#### 4. é…ç½®éªŒè¯ç ç±»å‹
1. ç‚¹å‡» "ğŸ”’ Captcha Settings"
2. é€‰æ‹©ç±»å‹ï¼š
   - **Math** - æ•°å­¦é¢˜ï¼ˆ1-50ï¼‰
   - **Button** - æŒ‰é’®éªŒè¯
   - **Image** - å›¾ç‰‡éªŒè¯ç  â­æ–°åŠŸèƒ½

### ç”¨æˆ·ä½“éªŒæµç¨‹

#### é¦–æ¬¡å‘é€æ¶ˆæ¯
1. æ”¶åˆ°éªŒè¯ç ï¼ˆæ ¹æ®è®¾ç½®ï¼‰
2. å›ç­”éªŒè¯ç 
3. éªŒè¯æˆåŠŸåå¯æ­£å¸¸å‘é€æ¶ˆæ¯

#### éªŒè¯å¤±è´¥
1. æ˜¾ç¤ºé”™è¯¯æç¤ºå’Œå‰©ä½™æ¬¡æ•°
   ```
   âŒ ç­”æ¡ˆé”™è¯¯ï¼ˆ1/3æ¬¡å°è¯•ï¼‰
   è¯·é‡æ–°å°è¯•ï¼š
   23 + 45 = ?
   ```

2. æ¯æ¬¡å¤±è´¥ç”Ÿæˆæ–°é¢˜ç›®

3. 3æ¬¡å¤±è´¥åï¼š
   ```
   âŒ æ‚¨å› 3æ¬¡éªŒè¯å¤±è´¥å·²è¢«å°ç¦ã€‚

   å¦‚æœæ‚¨è®¤ä¸ºè¿™æ˜¯è¯¯åˆ¤ï¼Œå¯ä»¥æäº¤ç”³è¯‰ï¼ˆä»…æœ‰ä¸€æ¬¡æœºä¼šï¼‰ã€‚

   [ç”³è¯‰] æŒ‰é’®
   ```

#### ç”³è¯‰æµç¨‹
1. ç‚¹å‡»ç”³è¯‰æŒ‰é’®
2. ç­‰å¾…å®¡æ ¸
3. æ”¶åˆ°ç»“æœé€šçŸ¥ï¼š
   - **æ‰¹å‡†ï¼š** å¯ä»¥é‡æ–°éªŒè¯
   - **æ‹’ç»ï¼š** æ— æ³•å†æ¬¡ç”³è¯‰

### å¤šè¯­è¨€æ”¯æŒ

**åˆ‡æ¢è¯­è¨€ï¼š**
```bash
# è‹±æ–‡
python main.py -token TOKEN -group_id ID -language en_US

# ä¸­æ–‡
python main.py -token TOKEN -group_id ID -language zh_CN

# æ—¥æ–‡
python main.py -token TOKEN -group_id ID -language ja_JP
```

**Dockerç¯å¢ƒï¼š**
```bash
docker run -e LANGUAGE=zh_CN ...
```

---

## ğŸ” å®‰å…¨ç‰¹æ€§

### 1. é¢‘ç‡é™åˆ¶
- éªŒè¯ç è¯·æ±‚é—´éš”ï¼š10ç§’
- é˜²æ­¢æš´åŠ›è¯·æ±‚

### 2. å°è¯•æ¬¡æ•°é™åˆ¶
- æœ€å¤š3æ¬¡éªŒè¯æœºä¼š
- è¶…é™è‡ªåŠ¨å°ç¦

### 3. ä¸€æ¬¡æ€§ç”³è¯‰
- æ¯ä¸ªç”¨æˆ·åªèƒ½ç”³è¯‰ä¸€æ¬¡
- é˜²æ­¢æ»¥ç”¨ç”³è¯‰ç³»ç»Ÿ

### 4. å°ç¦åŸå› è¿½è¸ª
- åŒºåˆ†æ‰‹åŠ¨å°ç¦å’Œè‡ªåŠ¨å°ç¦
- ä¾¿äºç®¡ç†å‘˜å®¡æ ¸

### 5. éªŒè¯ç åŠ¨æ€ç”Ÿæˆ
- æ¯æ¬¡å¤±è´¥ç”Ÿæˆæ–°é¢˜ç›®
- é˜²æ­¢è®°å¿†ç­”æ¡ˆ

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. ç¼“å­˜ç­–ç•¥
- éªŒè¯çŠ¶æ€ç¼“å­˜ï¼š1800ç§’
- éªŒè¯ç ç­”æ¡ˆç¼“å­˜ï¼š300ç§’
- é¢‘ç‡é™åˆ¶ç¼“å­˜ï¼š10ç§’

### 2. æ•°æ®åº“ç´¢å¼•
```sql
CREATE UNIQUE INDEX idx_verification_attempts_user
ON verification_attempts(user_id);

CREATE UNIQUE INDEX idx_appeal_requests_user
ON appeal_requests(user_id);
```

### 3. å›¾ç‰‡ç”Ÿæˆä¼˜åŒ–
- ä½¿ç”¨ BytesIO å†…å­˜æ“ä½œ
- æ— éœ€ä¸´æ—¶æ–‡ä»¶
- è‡ªåŠ¨åƒåœ¾å›æ”¶

---

## ğŸ› å·²çŸ¥é—®é¢˜å’Œé™åˆ¶

### 1. å›¾ç‰‡éªŒè¯ç å­—ä½“
- **é—®é¢˜ï¼š** Alpine Linux é»˜è®¤æ—  DejaVu Sans å­—ä½“
- **è§£å†³ï¼š** è‡ªåŠ¨é™çº§åˆ°é»˜è®¤å­—ä½“
- **å½±å“ï¼š** å­—ä½“ç¨å°ï¼Œä½†åŠŸèƒ½æ­£å¸¸

### 2. ç”³è¯‰æ¬¡æ•°
- **é™åˆ¶ï¼š** æ¯ä¸ªç”¨æˆ·åªèƒ½ç”³è¯‰ä¸€æ¬¡
- **åŸå› ï¼š** é˜²æ­¢æ»¥ç”¨
- **å»ºè®®ï¼š** ç®¡ç†å‘˜å¯æ‰‹åŠ¨è§£å°é‡ç½®

### 3. Docker é•œåƒå¤§å°
- **å¤§å°ï¼š** ~150MBï¼ˆå« Pillow ä¾èµ–ï¼‰
- **ä¼˜åŒ–ï¼š** ä½¿ç”¨ Alpine åŸºç¡€é•œåƒ
- **å»ºè®®ï¼š** ç”Ÿäº§ç¯å¢ƒå¯ä½¿ç”¨ multi-stage build

---

## ğŸ”„ æ›´æ–°æ—¥å¿—

### v2.0 - 2025-12-25

#### æ–°å¢åŠŸèƒ½
- âœ… éªŒè¯å°è¯•æ¬¡æ•°é™åˆ¶ï¼ˆ3æ¬¡ï¼‰
- âœ… è‡ªåŠ¨å°ç¦æœºåˆ¶
- âœ… ç”³è¯‰ç³»ç»Ÿï¼ˆåŒæ¨¡å¼ï¼‰
- âœ… å›¾ç‰‡éªŒè¯ç æ”¯æŒ
- âœ… MathéªŒè¯ç éš¾åº¦æå‡
- âœ… é¢‘ç‡é™åˆ¶ä¿æŠ¤
- âœ… å®Œæ•´çš„å¤šè¯­è¨€ç¿»è¯‘
- âœ… Docker æ”¯æŒä¼˜åŒ–

#### æ•°æ®åº“å˜æ›´
- âœ… æ–°å¢ verification_attempts è¡¨
- âœ… æ–°å¢ appeal_requests è¡¨
- âœ… æ‰©å±• blocked_users è¡¨

#### æ–‡ä»¶å˜æ›´
- æ–°å¢ï¼š7 ä¸ªæ–‡ä»¶
- ä¿®æ”¹ï¼š7 ä¸ªæ–‡ä»¶
- æ€»è®¡ï¼š+895 è¡Œä»£ç 

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š
- [pyTelegramBotAPI](https://github.com/eternnoir/pyTelegramBotAPI) - Telegram Bot API
- [Pillow](https://python-pillow.org/) - Pythonå›¾åƒå¤„ç†åº“
- [diskcache](https://github.com/grantjenks/python-diskcache) - ç¼“å­˜ç³»ç»Ÿ

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹ [DOCKER.md](DOCKER.md) éƒ¨ç½²æ–‡æ¡£
2. è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š`python test_simple.py`
3. æŸ¥çœ‹æ—¥å¿—ï¼š`docker logs betterforward`

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0
**æœ€åæ›´æ–°ï¼š** 2025-12-25
**ç”Ÿæˆå·¥å…·ï¼š** Claude Sonnet 4.5
